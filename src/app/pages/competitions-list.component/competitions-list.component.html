<main class="table-container w-100">
  <div class="card shadow-sm fade-table" [class.show]="tableVisible()">
    <div class="card-body p-3">
      <!-- Search -->
      <div class="mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="Search competitions..."
          [ngModel]="searchQuery()"
          (ngModelChange)="searchQuery.set($event)"
          [disabled]="isLoading()"
        />
      </div>
      <!-- Table -->
      <div class="table-wrapper">
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead class="bg-dark text-white">
              <tr>
                <th>No.</th>
                <th>Title</th>
                <th>Description</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                @if(user() === 'admin') {
                <th class="text-center">Actions</th>
                }
              </tr>
            </thead>
            <tbody>
              <!-- Skeleton rows -->
              @if(isLoading()) { @for(i of loadingArray(); track i.id) {
              <tr>
                <td><div class="skeleton w-3/4 h-4 mx-auto"></div></td>
                <td><div class="skeleton w-full h-4"></div></td>
                <td><div class="skeleton w-full h-4"></div></td>
                <td><div class="skeleton w-3/4 h-4"></div></td>
                <td><div class="skeleton w-3/4 h-4"></div></td>
                <td><div class="skeleton w-1/2 h-4"></div></td>
                @if(user() === 'admin') {
                <td><div class="skeleton w-3/4 h-4 mx-auto"></div></td>
                }
              </tr>
              } } @else if(error()) {
              <!-- Error row -->
              <tr>
                <td [attr.colspan]="getColspan()" class="text-center">
                  {{ error() }}
                </td>
              </tr>
              } @else {
              <!-- Real data rows -->
              @for(row of displayedRows(); track row.competition.competitionId)
              {
              <tr>
                <td>{{ row.index }}</td>
                <td>{{ row.competition.title }}</td>
                <td>{{ row.competition.description }}</td>
                <td>{{ row.competition.startDate | date : "MM/dd/yyyy" }}</td>
                <td>{{ row.competition.endDate | date : "MM/dd/yyyy" }}</td>
                <td>{{ row.competition.status }}</td>
                @if(user() === 'admin') {
                <td class="text-center">
                  <div class="d-flex gap-1">
                    <button
                      type="button"
                      class="btn btn-sm btn-success"
                      (click)="editCompetition(row.competition)"
                    >
                      Edit
                    </button>
                    <button
                      type="button"
                      class="btn btn-sm btn-danger"
                      (click)="openDeleteModal(row.competition)"
                    >
                      Delete
                    </button>
                  </div>
                </td>
                }
              </tr>
              } }
            </tbody>
          </table>
        </div>
      </div>
      <!-- Pagination -->
      @if(isLoading()) {
      <div class="d-flex justify-content-center my-3">
        <div class="skeleton skeleton-footer"></div>
      </div>
      } @else {
      <app-pagination
        [currentPage]="currentPage()"
        [totalPages]="totalPages()"
        [maximumVisible]="3"
        [disabled]="isLoading()"
        (pageChange)="setCurrentPage($event)"
      >
      </app-pagination>
      }
    </div>
  </div>
</main>
