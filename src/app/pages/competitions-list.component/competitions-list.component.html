<main class="table-container w-100">
  <div
    class="card shadow-sm fade-table"
    [class.show]="tableVisible() || isLoading()"
  >
    <div class="card-body p-3">
      <!-- Search -->
      <div class="mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="Search competitions..."
          [ngModel]="searchQuery()"
          (ngModelChange)="searchQuery.set($event)"
          [disabled]="isLoading()"
        />
      </div>
      <!-- Table -->
      <div class="table-wrapper">
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead class="bg-dark text-white">
              <tr>
                <th>No.</th>
                <th>Title</th>
                <th>Description</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                @if(user() === 'admin') {
                <th class="text-center">Actions</th>
                }
              </tr>
            </thead>
            <tbody>
              <!-- Loading row -->
              @if(isLoading()) {
              <tr>
                <td
                  [attr.colspan]="getColspan()"
                  class="text-center text-muted"
                >
                  Data loading...
                </td>
              </tr>
              } @else if(error()) {
              <!-- Error row -->
              <tr>
                <td
                  [attr.colspan]="getColspan()"
                  class="text-center text-danger"
                >
                  {{ error() }}
                </td>
              </tr>
              } @else {
              <!-- Real data rows -->
              @for(competition of paginatedCompetitions(); track
              competition.competitionId) {
              <tr>
                <td>
                  {{
                    (currentPage() - 1) * itemsPerPage() +
                      paginatedCompetitions().indexOf(competition) +
                      1
                  }}
                </td>
                <td>{{ competition.title }}</td>
                <td>{{ competition.description }}</td>
                <td>{{ competition.startDate | date : "MM/dd/yyyy" }}</td>
                <td>{{ competition.endDate | date : "MM/dd/yyyy" }}</td>
                <td>{{ competition.status }}</td>
                @if(user() === 'admin') {
                <td class="text-center">
                  <div class="d-flex gap-1">
                    <button
                      type="button"
                      class="btn btn-sm btn-success"
                      (click)="editCompetition(competition)"
                    >
                      Edit
                    </button>
                    <button
                      type="button"
                      class="btn btn-sm btn-danger"
                      (click)="openDeleteModal(competition)"
                    >
                      Delete
                    </button>
                  </div>
                </td>
                }
              </tr>
              } }
            </tbody>
          </table>
        </div>
      </div>
      <!-- Pagination -->
      <app-pagination
        [currentPage]="currentPage()"
        [totalPages]="totalPages()"
        [maximumVisible]="3"
        [disabled]="isLoading()"
        (pageChange)="setCurrentPage($event)"
      >
      </app-pagination>
    </div>
  </div>
</main>
